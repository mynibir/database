<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXE Version Control System</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #f8fafc;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #ff0000;
        }

        .card {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #94a3b8;
            font-weight: 500;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: rgba(15, 23, 42, 0.6);
            color: #f8fafc;
            font-size: 16px;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ff0000;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #ff0000;
            color: white;
        }

        .btn-primary:hover {
            background: #cc0000;
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-secondary:hover {
            background: #334155;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-google {
            background: #4285f4;
            color: white;
        }

        .btn-google:hover {
            background: #3367d6;
        }

        .version-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .version-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #ff0000;
        }

        .version-number {
            background: rgba(255, 0, 0, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .version-description {
            color: #94a3b8;
            line-height: 1.5;
        }

        .version-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-active {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .status-inactive {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4444;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }

        .status-deprecated {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }

        .mono-text {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .info-box {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .status-success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #00ff00;
        }

        .status-error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff4444;
        }

        .loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .raw-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .copy-btn:hover {
            background: #2563eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #ff0000;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9em;
        }

        .exe-code-block {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ff0000;
        }

        .exe-code-block code {
            font-family: 'Courier New', monospace;
            color: #00ff00;
            line-height: 1.5;
        }

        .download-link {
            display: inline-block;
            background: #059669;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin: 10px 0;
            font-weight: 600;
        }

        .download-link:hover {
            background: #047857;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”„ EXE Version Control System</h1>
            <p>Manage application versions and auto-disable old EXE files</p>
        </header>

        <!-- Auth Card -->
        <div class="card" id="auth-card">
            <div class="tabs">
                <button class="tab active" data-tab="login">Login</button>
                <button class="tab" data-tab="register">Register</button>
            </div>

            <!-- Login Tab -->
            <div class="tab-content active" id="login-content">
                <form id="login-form">
                    <div class="form-group">
                        <input type="email" id="login-email" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="login-password" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                
                <div style="text-align: center; margin: 15px 0; color: #94a3b8;">OR</div>
                
                <button class="btn btn-google" onclick="signInWithGoogle()">
                    Login with Google
                </button>
            </div>

            <!-- Register Tab -->
            <div class="tab-content" id="register-content">
                <form id="register-form">
                    <div class="form-group">
                        <input type="email" id="register-email" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="register-password" placeholder="Password (min 6 characters)" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Register</button>
                </form>
            </div>

            <div id="auth-status"></div>
        </div>

        <!-- Dashboard Card -->
        <div class="card hidden" id="dashboard-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #ff0000;">Dashboard</h2>
                <div>
                    <span id="user-email" style="color: #94a3b8; margin-right: 15px;"></span>
                    <button class="btn btn-secondary" onclick="logout()" style="width: auto;">Logout</button>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-versions">0</div>
                    <div class="stat-label">Total Versions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-versions">0</div>
                    <div class="stat-label">Active Versions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="deprecated-versions">0</div>
                    <div class="stat-label">Deprecated</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-downloads">0</div>
                    <div class="stat-label">Total Downloads</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="versions">Version Management</button>
                <button class="tab" data-tab="create">Create Version</button>
                <button class="tab" data-tab="api">API & Integration</button>
                <button class="tab" data-tab="raw">Raw Data</button>
            </div>

            <!-- Version Management -->
            <div class="tab-content active" id="versions-content">
                <div class="info-box">
                    <h3 style="margin-bottom: 15px;">ðŸ“‹ Your Application Versions</h3>
                    <div id="versions-list">Loading versions...</div>
                </div>
            </div>

            <!-- Create Version -->
            <div class="tab-content" id="create-content">
                <div class="info-box">
                    <h3 style="margin-bottom: 15px;">ðŸš€ Create New Version</h3>
                    <form id="version-form">
                        <div class="form-group">
                            <label for="version-name">Version Name</label>
                            <input type="text" id="version-name" placeholder="e.g., Stable Release, Beta v2" required>
                        </div>
                        <div class="form-group">
                            <label for="version-number">Version Number</label>
                            <input type="text" id="version-number" placeholder="e.g., 1.0.0, 2.1.3" required>
                        </div>
                        <div class="form-group">
                            <label for="version-description">Release Notes</label>
                            <textarea id="version-description" placeholder="Describe what's new in this version..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="version-download">Download URL</label>
                            <input type="url" id="version-download" placeholder="https://your-site.com/download/app-v1.0.0.exe" required>
                        </div>
                        <div class="form-group">
                            <label for="version-status">Initial Status</label>
                            <select id="version-status">
                                <option value="active">Active (Will disable previous versions)</option>
                                <option value="inactive">Inactive (For testing)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" id="create-version-btn">Create Version</button>
                    </form>
                </div>
            </div>

            <!-- API & Integration -->
            <div class="tab-content" id="api-content">
                <div class="info-box">
                    <h3 style="margin-bottom: 15px;">ðŸ”— EXE Integration Code</h3>
                    
                    <div class="exe-code-block">
                        <h4 style="color: #ff6b6b; margin-bottom: 15px;">C# Implementation for Your EXE:</h4>
                        <code>
using System;<br>
using System.Net.Http;<br>
using System.Threading.Tasks;<br>
<br>
class VersionChecker<br>
{<br>
    private static readonly string API_URL = "<span id="api-url-example">https://yoursite.com/api/check-version</span>";<br>
    private static readonly string CURRENT_VERSION = "1.0.0"; // Update this for each release<br>
<br>
    public static async Task&lt;bool&gt; IsVersionValid()<br>
    {<br>
        try<br>
        {<br>
            using (var client = new HttpClient())<br>
            {<br>
                var response = await client.GetStringAsync($"{API_URL}?version={CURRENT_VERSION}");<br>
                return response.Contains("\"status\":\"active\"");<br>
            }<br>
        }<br>
        catch<br>
        {<br>
            return false; // If can't connect, assume invalid<br>
        }<br>
    }<br>
<br>
    public static async Task CheckAndExitIfInvalid()<br>
    {<br>
        if (!await IsVersionValid())<br>
        {<br>
            Console.WriteLine("This version is deprecated. Please download the latest version.");<br>
            Environment.Exit(0);<br>
        }<br>
    }<br>
}
                        </code>
                    </div>

                    <div class="exe-code-block">
                        <h4 style="color: #ff6b6b; margin-bottom: 15px;">API Endpoint (Node.js/Express):</h4>
                        <code>
// Check version status<br>
app.get('/api/check-version', async (req, res) => {<br>
    const version = req.query.version;<br>
    <br>
    // Query Firebase for version status<br>
    const snapshot = await db.collection('versions')<br>
        .where('number', '==', version)<br>
        .limit(1)<br>
        .get();<br>
    <br>
    if (snapshot.empty) {<br>
        return res.json({ status: 'not_found', valid: false });<br>
    }<br>
    <br>
    const versionData = snapshot.docs[0].data();<br>
    res.json({ <br>
        status: versionData.status,<br>
        valid: versionData.status === 'active',<br>
        latest: versionData.number,<br>
        download: versionData.downloadUrl<br>
    });<br>
});
                        </code>
                    </div>

                    <button class="copy-btn" onclick="copyIntegrationCode()">Copy C# Code</button>
                </div>
            </div>

            <!-- Raw Data -->
            <div class="tab-content" id="raw-content">
                <div class="info-box">
                    <h3 style="margin-bottom: 15px;">ðŸ“„ Active Version Data</h3>
                    <p style="margin-bottom: 15px; color: #94a3b8;">
                        This is the data that your EXE will check to see if it should run.
                    </p>
                    <div class="raw-content" id="raw-content-display">
                        No active version available.
                    </div>
                    <button class="copy-btn" onclick="copyRawContent()">Copy Raw Content</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD-AUFMFLhZ4wYma78LbtKil1Rcmk_Q8Kg",
            authDomain: "dashboard-config-ace02.firebaseapp.com",
            projectId: "dashboard-config-ace02",
            storageBucket: "dashboard-config-ace02.firebasestorage.app",
            messagingSenderId: "166283646188",
            appId: "1:166283646188:web:5e7f1ffd9a0d414f9881c9",
            measurementId: "G-52F0L8BCMJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let isEditing = false;
        let editingVersionId = null;

        function showStatus(message, isSuccess = true) {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.innerHTML = `<div class="status-message ${isSuccess ? 'status-success' : 'status-error'}">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            if (tabName === 'versions') {
                loadVersions();
            } else if (tabName === 'raw') {
                loadRawContent();
            } else if (tabName === 'api') {
                updateApiExample();
            }
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // Login form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showStatus('Login successful!');
            } catch (error) {
                showStatus('Login failed: ' + error.message, false);
            }
        });

        // Register form
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;

            if (password.length < 6) {
                showStatus('Password must be at least 6 characters', false);
                return;
            }

            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showStatus('Registration successful! Please login.');
                switchTab('login');
            } catch (error) {
                showStatus('Registration failed: ' + error.message, false);
            }
        });

        // Google Sign In
        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                await auth.signInWithPopup(provider);
                showStatus('Google login successful!');
            } catch (error) {
                showStatus('Google login failed: ' + error.message, false);
            }
        }

        // Logout
        async function logout() {
            try {
                await auth.signOut();
                showStatus('Logged out successfully!');
            } catch (error) {
                showStatus('Logout failed: ' + error.message, false);
            }
        }

        // Create or Update version
        document.getElementById('version-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('version-name').value.trim();
            const number = document.getElementById('version-number').value.trim();
            const description = document.getElementById('version-description').value.trim();
            const downloadUrl = document.getElementById('version-download').value.trim();
            const status = document.getElementById('version-status').value;
            const createBtn = document.getElementById('create-version-btn');
            
            if (!name || !number || !description || !downloadUrl) {
                showStatus('Please fill in all fields', false);
                return;
            }
            
            // Show loading state
            createBtn.textContent = isEditing ? 'Updating...' : 'Creating...';
            createBtn.classList.add('loading');
            createBtn.disabled = true;
            
            try {
                if (isEditing) {
                    // Update existing version
                    await db.collection('versions').doc(editingVersionId).update({
                        name: name,
                        number: number,
                        description: description,
                        downloadUrl: downloadUrl,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showStatus('Version updated successfully!');
                    resetForm();
                } else {
                    // If setting as active, deactivate all previous versions
                    if (status === 'active') {
                        const versionsSnapshot = await db.collection('versions')
                            .where('owner', '==', currentUser.email)
                            .get();
                        
                        const batch = db.batch();
                        
                        versionsSnapshot.forEach(doc => {
                            batch.update(doc.ref, { 
                                status: 'deprecated',
                                deprecatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        });
                        
                        await batch.commit();
                    }
                    
                    // Create new version
                    const newVersionRef = db.collection('versions').doc();
                    await newVersionRef.set({
                        id: newVersionRef.id,
                        name: name,
                        number: number,
                        description: description,
                        downloadUrl: downloadUrl,
                        status: status,
                        owner: currentUser.email,
                        downloadCount: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showStatus(`Version ${number} created successfully! ${status === 'active' ? 'Previous versions deprecated.' : ''}`);
                    resetForm();
                }
                
                // Refresh versions list and stats
                loadVersions();
                loadStats();
                
            } catch (error) {
                console.error('Error saving version:', error);
                showStatus('Error: ' + error.message, false);
            } finally {
                createBtn.textContent = isEditing ? 'Update Version' : 'Create Version';
                createBtn.classList.remove('loading');
                createBtn.disabled = false;
            }
        });

        function resetForm() {
            document.getElementById('version-form').reset();
            isEditing = false;
            editingVersionId = null;
            document.getElementById('create-version-btn').textContent = 'Create Version';
            document.getElementById('version-status').value = 'active';
        }

        // Load versions and stats
        async function loadVersions() {
            try {
                const snapshot = await db.collection('versions')
                    .where('owner', '==', currentUser.email)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                let html = '';
                
                if (snapshot.empty) {
                    html = '<p style="text-align: center; color: #94a3b8;">No versions created yet.</p>';
                } else {
                    snapshot.forEach(doc => {
                        const version = doc.data();
                        const date = version.createdAt ? version.createdAt.toDate().toLocaleDateString() : 'Unknown date';
                        
                        let statusClass = 'status-inactive';
                        let statusText = 'INACTIVE';
                        
                        if (version.status === 'active') {
                            statusClass = 'status-active';
                            statusText = 'ACTIVE';
                        } else if (version.status === 'deprecated') {
                            statusClass = 'status-deprecated';
                            statusText = 'DEPRECATED';
                        }
                        
                        html += `
                            <div class="version-card">
                                <div class="version-header">
                                    <span class="version-name">${version.name}</span>
                                    <span class="version-number">${version.number}</span>
                                </div>
                                <div class="version-description">${version.description}</div>
                                <div style="margin: 10px 0;">
                                    <a href="${version.downloadUrl}" target="_blank" class="download-link">
                                        ðŸ“¥ Download EXE
                                    </a>
                                    <span style="color: #94a3b8; margin-left: 15px;">
                                        Downloads: ${version.downloadCount || 0}
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                    <span class="version-status ${statusClass}">${statusText}</span>
                                    <span style="color: #94a3b8; font-size: 0.9em;">Created: ${date}</span>
                                </div>
                                <div class="action-buttons">
                                    <button class="btn btn-secondary" onclick="editVersion('${doc.id}')" style="width: auto;">Edit</button>
                                    <button class="btn btn-success" onclick="activateVersion('${doc.id}')" style="width: auto;" ${version.status === 'active' ? 'disabled' : ''}>
                                        ${version.status === 'active' ? 'Active' : 'Activate'}
                                    </button>
                                    <button class="btn" onclick="deleteVersion('${doc.id}')" style="width: auto; background: #dc2626; color: white;">Delete</button>
                                </div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('versions-list').innerHTML = html;
                
            } catch (error) {
                console.error('Error loading versions:', error);
                document.getElementById('versions-list').innerHTML = 
                    '<p style="color: #ff4444;">Error loading versions: ' + error.message + '</p>';
            }
        }

        // Load stats
        async function loadStats() {
            try {
                const snapshot = await db.collection('versions')
                    .where('owner', '==', currentUser.email)
                    .get();
                
                let total = 0;
                let active = 0;
                let deprecated = 0;
                let totalDownloads = 0;
                
                snapshot.forEach(doc => {
                    const version = doc.data();
                    total++;
                    totalDownloads += version.downloadCount || 0;
                    
                    if (version.status === 'active') {
                        active++;
                    } else if (version.status === 'deprecated') {
                        deprecated++;
                    }
                });
                
                document.getElementById('total-versions').textContent = total;
                document.getElementById('active-versions').textContent = active;
                document.getElementById('deprecated-versions').textContent = deprecated;
                document.getElementById('total-downloads').textContent = totalDownloads;
                
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Edit version
        async function editVersion(versionId) {
            try {
                const versionDoc = await db.collection('versions').doc(versionId).get();
                
                if (!versionDoc.exists) {
                    showStatus('Version not found', false);
                    return;
                }
                
                const version = versionDoc.data();
                
                document.getElementById('version-name').value = version.name;
                document.getElementById('version-number').value = version.number;
                document.getElementById('version-description').value = version.description;
                document.getElementById('version-download').value = version.downloadUrl;
                
                // Scroll to form
                document.getElementById('version-form').scrollIntoView({ behavior: 'smooth' });
                
                // Set editing mode
                isEditing = true;
                editingVersionId = versionId;
                document.getElementById('create-version-btn').textContent = 'Update Version';
                
                // Switch to create tab
                switchTab('create');
                
            } catch (error) {
                console.error('Error loading version for edit:', error);
                showStatus('Error loading version: ' + error.message, false);
            }
        }

        // Activate version (deprecates all others)
        async function activateVersion(versionId) {
            try {
                // Deprecate all versions
                const versionsSnapshot = await db.collection('versions')
                    .where('owner', '==', currentUser.email)
                    .get();
                
                const batch = db.batch();
                
                versionsSnapshot.forEach(doc => {
                    batch.update(doc.ref, { 
                        status: 'deprecated',
                        deprecatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });
                
                // Activate selected version
                batch.update(db.collection('versions').doc(versionId), { 
                    status: 'active',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await batch.commit();
                
                showStatus('Version activated! All previous versions are now deprecated.');
                loadVersions();
                loadStats();
                loadRawContent();
                
            } catch (error) {
                console.error('Error activating version:', error);
                showStatus('Error activating version: ' + error.message, false);
            }
        }

        // Delete version
        async function deleteVersion(versionId) {
            if (!confirm('Are you sure you want to delete this version?')) {
                return;
            }
            
            try {
                await db.collection('versions').doc(versionId).delete();
                showStatus('Version deleted successfully!');
                loadVersions();
                loadStats();
                loadRawContent();
            } catch (error) {
                console.error('Error deleting version:', error);
                showStatus('Error deleting version: ' + error.message, false);
            }
        }

        // Load raw content
        async function loadRawContent() {
            try {
                const snapshot = await db.collection('versions')
                    .where('owner', '==', currentUser.email)
                    .where('status', '==', 'active')
                    .limit(1)
                    .get();
                
                if (snapshot.empty) {
                    document.getElementById('raw-content-display').textContent = 'No active version available.';
                    return;
                }
                
                const version = snapshot.docs[0].data();
                const rawData = {
                    version: version.number,
                    name: version.name,
                    description: version.description,
                    downloadUrl: version.downloadUrl,
                    status: version.status,
                    lastUpdated: version.updatedAt ? version.updatedAt.toDate().toISOString() : 'Unknown',
                    valid: true
                };
                
                document.getElementById('raw-content-display').textContent = JSON.stringify(rawData, null, 2);
                
            } catch (error) {
                console.error('Error loading raw content:', error);
                document.getElementById('raw-content-display').textContent = 'Error loading content: ' + error.message;
            }
        }

        // Update API example URL
        function updateApiExample() {
            const currentUrl = window.location.origin;
            document.getElementById('api-url-example').textContent = currentUrl + '/api/check-version';
        }

        // Copy integration code
        function copyIntegrationCode() {
            const codeBlock = document.querySelector('.exe-code-block code');
            navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                showStatus('Integration code copied to clipboard!');
            }).catch(err => {
                showStatus('Failed to copy code: ' + err, false);
            });
        }

        // Copy raw content
        function copyRawContent() {
            const rawContent = document.getElementById('raw-content-display').textContent;
            navigator.clipboard.writeText(rawContent).then(() => {
                showStatus('Raw content copied to clipboard!');
            }).catch(err => {
                showStatus('Failed to copy content: ' + err, false);
            });
        }

        // Firebase Auth State Listener
        auth.onAuthStateChanged(user => {
            currentUser = user;
            
            if (user) {
                document.getElementById('auth-card').classList.add('hidden');
                document.getElementById('dashboard-card').classList.remove('hidden');
                document.getElementById('user-email').textContent = user.email;
                
                // Create or update user document
                db.collection('users').doc(user.email).set({
                    email: user.email,
                    role: 'user',
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                loadVersions();
                loadStats();
                loadRawContent();
                updateApiExample();
            } else {
                document.getElementById('auth-card').classList.remove('hidden');
                document.getElementById('dashboard-card').classList.add('hidden');
                resetForm();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ EXE Version Control System Initialized');
        });
    </script>
</body>
</html>
